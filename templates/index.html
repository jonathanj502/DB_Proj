</html>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Search</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"">
</head>
<body>
  <header class="topbar">
    <div class="brand">Book Search</div>
    <div class="top-actions">
      {# if a profile_id cookie is present show avatar linking to profile, otherwise show login link #}
      {% if request.cookies.get('profile_id') %}
        <a class="profile-link" href="{{ url_for('profile', profile_id=request.cookies.get('profile_id')) }}">
          <img class="avatar" src="{{ url_for('static', filename='img/default-avatar.png') }}"
               alt="{{ request.cookies.get('username') or 'Profile' }}" loading="lazy">
        </a>
      {% else %}
        <a class="signin" href="{{ url_for('login') }}">Log in</a>
      {% endif %}
    </div>
  </header>

  <div class="c">
    <!-- Centered search form -->
    <form action="/search" method="get" role="search" aria-label="Book search">
      <input type="search" name="q" placeholder="e.g. The Hunger Games, Suzanne Collins"
        value="{{ query|default('') }}" required aria-required="true">
      
      <br>
      <!-- Radio button group -->
      <fieldset style="margin-top: 1em;">
        <legend>Search for:</legend>
        <label>
          <input type="radio" name="mode" value="title"
                {% if mode == 'title' or not mode %}checked{% endif %}>
          Book Title
        </label>
        <label>
          <input type="radio" name="mode" value="author"
                {% if mode == 'author' %}checked{% endif %}>
          Author
        </label>
        <label>
          <input type="radio" name="mode" value="profile"
                {% if mode == 'profile' %}checked{% endif %}>
          User Profile
        </label>
        <label>
          <input type="radio" name="mode" value="bookshelf"
                {% if mode == 'bookshelf' %}checked{% endif %}>
          Bookshelf
        </label>
      </fieldset>
      
      <br>
      <button type="submit">Search</button>
    </form>
  </div>

  {% if results %}
    <div class="results" aria-live="polite">
      {% for b in results %}
        <div class="result-item">
          {% if b.type == "book" %}
            {% if b.image_url %}
              <a href="{{ url_for('book', book_id=b.id) }}">
                <img class="thumb" src="{{ b.image_url }}" alt="{{ b.title }}" loading="lazy"
                    onerror="this.style.display='none'">
              </a>
            {% endif %}
            <div class="info">
              <a href="{{ url_for('book', book_id=b.id) }}"><h2>{{ b.title }}</h2></a>
              <p>By {{ b.authors }}</p>
              <p>Published {{ b.published_year }}</p>
            </div>

          {% elif b.type == "author" %}
            <div class="info">
              <a href="{{ url_for('author', author_id=b.id) }}">
                <h2>{{ b.title }}</h2>
              </a>
              <p>Nationality: {{ b.extra }}</p>
              <p>Born: {{ b.published_year }}</p>
            </div>


          {% elif b.type == "profile" %}
            <div class="info">
              <a href="{{ url_for('profile', profile_id=b.id) }}"><h2>{{ b.title }}</h2></a>
              <p>Joined: {{ b.published_year }}</p>
            </div>

          {% elif b.type == "bookshelf" %}
            <div class="info">
              <a href="{{ url_for('view_bookshelf', bookshelf_id=b.id) }}">
                <h2>{{ b.title }}</h2>
              </a>
              <p>Owner: {{ b.authors }}</p>
              <p>{{ b.extra }}</p>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    {% if query %}
      <p style="text-align:center;margin-top:20px">No results for "{{ query }}".</p>
    {% endif %}
  {% endif %}
</body>
</html>
